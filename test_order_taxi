# tests/test_order_taxi.py

import pytest
from selenium import webdriver
from pages.urban_routes_page import UrbanRoutesPage
from data.data import user_phone, user_address, card_number, card_expiry, card_cvv, driver_message, retrieve_phone_code
from config.settings import BASE_URL

class TestUrbanRoutes:
    def setup_method(self):
        self.driver = webdriver.Chrome()
        self.driver.get(BASE_URL)
        self.page = UrbanRoutesPage(self.driver)

    def teardown_method(self):
        self.driver.quit()

    def test_complete_taxi_order(self):
        # Configurar dirección
        self.page.set_address(user_address)

        # Seleccionar tarifa Comfort
        self.page.select_comfort_tariff()

        # Rellenar teléfono
        self.page.enter_phone_number(user_phone)

        # Agregar tarjeta de crédito
        self.page.add_credit_card(card_number, card_expiry, card_cvv)

        # Confirmar código de teléfono
        code = retrieve_phone_code()
        self.page.confirm_phone_code(code)

        # Escribir mensaje para conductor
        self.page.write_message(driver_message)

        # Pedir extras
        self.page.request_extras(blanket=True, tissues=True, ice_cream_qty=2)

        # Pedir taxi
        self.page.request_taxi()

        # Esperar modal de conductor
        self.page.wait_for_driver_info()
